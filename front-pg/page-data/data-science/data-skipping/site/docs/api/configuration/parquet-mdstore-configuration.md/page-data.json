{"componentChunkName":"component---src-templates-markdown-js","path":"/data-science/data-skipping/site/docs/api/configuration/parquet-mdstore-configuration.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"f3a745e1-0804-514c-8c5e-f53165dfa50e","html":"<!--\n -- Copyright 2021 IBM Corp.\n -- SPDX-License-Identifier: Apache-2.0\n -->\n<h1 id=\"parquet-metadatastore-properties\" style=\"position:relative;\"><a href=\"#parquet-metadatastore-properties\" aria-label=\"parquet metadatastore properties permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Parquet Metadatastore properties</h1>\n<p>Xskipper uses Parquet as the metadatastore.<br>\nThe Parquet metadatastore store the metadata for the objects as rows in parquet file. See <a href=\"../developer/parquet-metadatastore-spec.md\">here</a> for more details.</p>\n<p>The following are parameters relevant for the Parquet metadatastore.  </p>\n<p>These parameters can be set as:</p>\n<ul class=\"pf-c-list\">\n<li>JVM wide configuration as described <a href=\"configuration.md#setting-jvm-wide-configuration\">here</a>.</li>\n<li>Specific Xskipper instance as described <a href=\"configuration.md#setting-configuration-for-a-specific-xskipper-instance\">here</a>.</li>\n</ul>\n<table class=\"pf-c-table\">\n<thead>\n<tr>\n<th>Property</th>\n<th>Default</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>io.xskipper.parquet<br/>.mdlocation</td>\n<td>N/A</td>\n<td>The metadata location according to the type</td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.mdlocation.type</td>\n<td>EXPLICIT<em>BASE</em>PATH_LOCATION</td>\n<td>See <a href=\"#types-of-metadata-location\">here</a></td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.index.chunksize</td>\n<td>25000</td>\n<td>The number of objects to index in each chunk</td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.maxRecordsPerMetadataFile</td>\n<td>50000</td>\n<td>The number of records per metadata file used in the compact stage to limit the number of records for small sized metadata files.</td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.maxMetadataFileSize</td>\n<td>33554432 (32MB)</td>\n<td>The expected max size of each metadata file will be used by the compact function to distribute the data to multiple files to distribute the data to multiple files in such way that each is less than the expected max size of each metadata file used in conjunction with the max records per file configuration</td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.encryption.plaintext.footer</td>\n<td>false</td>\n<td>Whether or not to use plain footer</td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.encryption.footer.key</td>\n<td>N/A</td>\n<td>The encryption key that will be used to encrypt the metadata footer</td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.refresh.dedup</td>\n<td>true</td>\n<td>When set to true each refresh operation will drop duplicates metadata entries (which might exist due to failed refresh operations)</td>\n</tr>\n<tr>\n<td>io.xskipper.parquet<br/>.filter.dedup</td>\n<td>false</td>\n<td>When set to true duplicate metadata entries (which might exist due to failed refresh operations) will be dropped when filtering in query run time</td>\n</tr>\n</tbody>\n</table>\n<p>!!! Note\nDeduplication during filtering is documented as <code class=\"language-text\">false</code> by default, but in version <code class=\"language-text\">1.2.3</code> it accidentally defaults to <code class=\"language-text\">true</code>.\nthis cannot affect query results, but may degrade performance.\nas a workaround, it can be manually set <code class=\"language-text\">io.xskipper.parquet.filter.dedup</code> to <code class=\"language-text\">false</code>.</p>\n<h2 id=\"types-of-metadata-location\" style=\"position:relative;\"><a href=\"#types-of-metadata-location\" aria-label=\"types of metadata location permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of metadata location</h2>\n<p>The parquet metadatastore looks up the metadata location according to the paramater <code class=\"language-text\">io.xskipper.parquet.mdlocation</code>, this parameter  is interpreted according to the URL type defined in the parameter <code class=\"language-text\">io.xskipper.parquet.mdlocation.type</code>.  </p>\n<p>The following options are available for the parameter <code class=\"language-text\">io.xskipper.parquet.mdlocation.type</code>:</p>\n<ul class=\"pf-c-list\">\n<li><code class=\"language-text\">EXPLICIT_BASE_PATH_LOCATION</code>: This is the default. An explicit definition of the base path to the metadata, which is combined with a data set identifier. This case can be used to configure the Xskipper JVM wide settings and have all of data sets metadata saved under the base path.</li>\n<li><code class=\"language-text\">EXPLICIT_LOCATION</code>: An explicit full path to the metadata.</li>\n<li><code class=\"language-text\">HIVE_TABLE_NAME</code>: The name of the Hive table (in the form of <code class=\"language-text\">&lt;db&gt;.&lt;table&gt;</code>) that contains the exact path of the metadata in the table properties under the parameter <code class=\"language-text\">io.xskipper.parquet.mdlocation</code>.</li>\n<li><code class=\"language-text\">HIVE_DB_NAME</code>: The name of the Hive database that contains the base path of the metadata in the database properties under the parameter <code class=\"language-text\">io.xskipper.parquet.mdlocation</code>.</li>\n</ul>\n<p>For more information on how the metadata path is resolved see <a href=\"#metadata-path-resolving\">here</a>.</p>\n<p>You should set the <code class=\"language-text\">io.xskipper.parquet.mdlocation</code> in one of two ways:</p>\n<h3 id=\"setting-base-location-for-metadata-recommended\" style=\"position:relative;\"><a href=\"#setting-base-location-for-metadata-recommended\" aria-label=\"setting base location for metadata recommended permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting base location for metadata (recommended)</h3>\n<p>  This configuration is useful for setting base location once for all datasets and should be used with the <code class=\"language-text\">EXPLICIT_BASE_PATH_LOCATION</code> or <code class=\"language-text\">HIVE_DB_NAME</code> types.</p>\n<p>  The location of the metadata for each data set will be inferred automatically by combining the base path with a data set identifier.</p>\n<p>  For example, setting <code class=\"language-text\">EXPLICIT_BASE_PATH_LOCATION</code>:</p>\n<p>=== “Python”</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">``` python\nfrom xskipper import Xskipper\n\n# The base location to store all indexes \n# TODO: change to your index base location\nmd_base_location = &quot;/tmp/metadata&quot;\n\n# Configuring the JVM wide parameters\nconf = dict([\n            (&quot;io.xskipper.parquet.mdlocation&quot;, md_base_location),\n            (&quot;io.xskipper.parquet.mdlocation.type&quot;, &quot;EXPLICIT_BASE_PATH_LOCATION&quot;)])\nXskipper.setConf(spark, conf)\n```</code></pre></div>\n<p>=== “Scala”</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">``` scala\nfrom xskipper import Xskipper\n\n# The base location to store all indexes \n# TODO: change to your index base location\nmd_base_location = &quot;/tmp/metadata&quot;\n\n# Configuring the JVM wide parameters\nconf = dict([\n            (&quot;io.xskipper.parquet.mdlocation&quot;, md_base_location),\n            (&quot;io.xskipper.parquet.mdlocation.type&quot;, &quot;EXPLICIT_BASE_PATH_LOCATION&quot;)])\nXskipper.setConf(spark, conf)\n```</code></pre></div>\n<h3 id=\"setting-an-explicit-metadata-location-for-xskipper-instance\" style=\"position:relative;\"><a href=\"#setting-an-explicit-metadata-location-for-xskipper-instance\" aria-label=\"setting an explicit metadata location for xskipper instance permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting an explicit metadata location for Xskipper instance</h3>\n<p>  This configuration is useful for setting a specific metadata location for a certain data set and should be used with the <code class=\"language-text\">EXPLICIT_LOCATION</code> or <code class=\"language-text\">HIVE_TABLE_NAME</code> type.<br>\nYou can also set it to <code class=\"language-text\">EXPLICIT_BASE_PATH_LOCATION</code> or <code class=\"language-text\">HIVE_DB_NAME</code> if you want to override the JVM defaults. </p>\n<p>  For example setting an <code class=\"language-text\">EXPLICIT_LOCATION</code> for xskipper instance:</p>\n<p>=== “Python”</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">``` python\nxskipper = Xskipper(spark_session, dataset_location)\n\n# call set params to make sure it overwrites JVM wide config\nparams = dict([\n    (&#39;io.xskipper.parquet.mdlocation&#39;, &#39;&lt;your metadata&gt;&#39;),\n    (&#39;io.xskipper.parquet.mdlocation.type&#39;, &#39;EXPLICIT_BASE_PATH_LOCATION&#39;)])\nxskipper.setParams(params)\n```</code></pre></div>\n<p>=== “Scala”</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">``` scala\nval xskipper = new Xskipper(spark, dataset_location)\n\n// call set params to make sure it overwrites JVM wide config\nval params = Map(\n  &quot;io.xskipper.parquet.mdlocation&quot; -&gt; &quot;&lt;your metadata&gt;&quot;,\n  &quot;io.xskipper.parquet.mdlocation.type&quot; -&gt;  &quot;EXPLICIT_BASE_PATH_LOCATION&quot;)\nxskipper.setParams(params)\n```</code></pre></div>\n  <br/>\n  Note that when setting the type to `HIVE_TABLE_NAME` you should first set the parameter `io.xskipper.parquet.mdlocation` in the table properties to point to the metadata location.  \n  \n  You can the set the metadata location for hive table manually using the following DDL:\n    ```sql\n    ALTER TABLE myDb.myTable\n    SET TBLPROPERTIES ('io.xskipper.parquet.mdlocation'='/location/of/metadata')\n    ```\n  \n  If the location does not exist in the Hive table, xskipper will try to look up the parameter `io.xskipper.parquet.mdlocation` in the table's database and treat it as a base path location.\n \n  When using `HIVE_TABLE_NAME` as the location type once indexing is done the parameter `io.xskipper.parquet.mdlocation` is set in the table properties.  \n  (in case a fallback to the database base path occured then the resolved path from using the database metadata location as base path is stored in the table properties)\n<h3 id=\"metadata-path-resolving\" style=\"position:relative;\"><a href=\"#metadata-path-resolving\" aria-label=\"metadata path resolving permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metadata path resolving</h3>\n<p>The following explains how the metadata path is resolved:</p>\n<ul class=\"pf-c-list\">\n<li>During Indexing the metadata location is inferred according to the parameters parameters <code class=\"language-text\">io.xskipper.parquet.mdlocation</code> and <code class=\"language-text\">io.xskipper.parquet.mdlocation.type</code> which are set on the xskipper instance.<br>\nThese parameters are the default JVM wide parameters unless set differently for the given instance.</li>\n<li>\n<p>During query run time, the metadata location is inferred according to the following</p>\n<ul class=\"pf-c-list\">\n<li>If there is an active xskipper instance in the JVM for the dataset/table use it’s metadata configuration. Otherwise: </li>\n<li>\n<p>For Datasets:</p>\n<ul class=\"pf-c-list\">\n<li>Look up the parameters <code class=\"language-text\">io.xskipper.parquet.mdlocation</code> and <code class=\"language-text\">io.xskipper.parquet.mdlocation.type</code> in the JVM wide configuration in order to infer the metadata location.</li>\n</ul>\n</li>\n<li>\n<p>For Hive tables (with partitions<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>):</p>\n<ul class=\"pf-c-list\">\n<li>If the table contains the parameter <code class=\"language-text\">io.xskipper.parquet.mdlocation</code> use it as the metadata location.</li>\n<li>If not, look up the parameter <code class=\"language-text\">io.xskipper.parquet.mdlocation</code> in the table’s database and treat it as a base path location.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>To index tables without partitions, index the physical location directly.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","fields":{"srcLink":"https://github.com/xskipper-io/xskipper/blob/master/site/docs/api/configuration/parquet-mdstore-configuration.md"},"frontmatter":{"title":"","description":null,"extraClasses":null}}},"pageContext":{"id":"f3a745e1-0804-514c-8c5e-f53165dfa50e"}},"staticQueryHashes":["117426894","3000541721","3606484676","533861647"]}